<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DES_AIç«¶é¦¬äºˆæƒ³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #0a1929 0%, #1a2332 100%);
            min-height: 100vh;
            color: #fff;
        }

        .header {
            background: linear-gradient(135deg, #0d3251 0%, #1a2332 100%);
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .title {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 14px;
            color: #b0c4de;
            margin-bottom: 3px;
        }

        .x-link {
            display: inline-block;
            background: transparent;
            color: #4fc3f7;
            padding: 12px 28px;
            border: 2px solid #4fc3f7;
            border-radius: 30px;
            text-decoration: none;
            font-size: 15px;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .x-link:hover {
            background: #4fc3f7;
            color: #0a1929;
        }

        .tab-nav {
    display: flex;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    background: rgba(255,255,255,0.04);
    border-radius: 14px;
    padding: 5px;
    margin-bottom: 16px;
    gap: 3px;
}
.tab-nav::-webkit-scrollbar { display: none; }

.tab-btn {
    flex: 1;
    min-width: 0;
    padding: 6px 4px;
    background: transparent;
    border: none;
    /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚: ãƒšãƒ¼ã‚¸èƒŒæ™¯ã«é¦´æŸ“ã‚€ã‚°ãƒ¬ãƒ¼ */
    color: #5a6a7e;
    cursor: pointer;
    border-radius: 10px;
    transition: all 0.2s;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
}

.tab-icon {
    font-size: 18px;
    line-height: 1;
    display: block;
}

.tab-label {
    font-size: 9px;
    font-weight: 600;
    line-height: 1;
    display: block;
    letter-spacing: 0.3px;
    /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–: èƒŒæ™¯è‰²ã«åˆã‚ã›ãŸã‚µãƒ–ã‚«ãƒ©ãƒ¼ */
    color: #5a6a7e;
}

.tab-btn.active {
    background: linear-gradient(135deg, #00bcd4 0%, #1565c0 100%);
    box-shadow: 0 2px 10px rgba(0, 188, 212, 0.45);
}

.tab-btn.active .tab-icon,
.tab-btn.active .tab-label {
    /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚: ç™½ */
    color: #ffffff;
}

        .content {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #00bcd4 0%, #2196f3 100%);
            border: none;
            color: #fff;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(33,150,243,0.3);
        }

        .update-info {
            background: rgba(79,195,247,0.1);
            border: 1px solid rgba(79,195,247,0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .update-label {
            font-size: 12px;
            color: #4fc3f7;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .update-time {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
        }

        /* å•é¡Œã®CSSã‚³ãƒ¡ãƒ³ãƒˆã‚‚å‰Šé™¤ */


.rpt-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}


.rpt-summary-card {
    background: linear-gradient(135deg, #2c3e50 0%, #1a2332 100%);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #2c3e50;
}


.rpt-summary-label {
    font-size: 12px;
    color: #7e8ea0;
    margin-bottom: 8px;
}


.rpt-summary-value {
    font-size: 24px;
    font-weight: 700;
    color: #fff;
}

.rpt-summary-value.positive {
    color: #4caf50;
}

.rpt-summary-value.negative {
    color: #f44336;
}


        .turbulence-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
            padding: 18px;
            background: rgba(13,71,161,0.15);
            border-radius: 12px;
        }

        .turbulence-item {
            text-align: center;
        }

        .turbulence-label {
            font-size: 12px;
            color: #b0c4de;
            margin-bottom: 8px;
        }

        .turbulence-value {
            font-size: 28px;
            font-weight: 700;
        }

        .turbulence-legend {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
        }

        .legend-title {
            font-size: 12px;
            color: #b0c4de;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }

        .legend-icon {
            font-size: 18px;
        }

        .legend-text {
            color: #b0c4de;
        }

        /* äºˆæƒ³ç•ªå·è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .race-number {
            font-size: 11px;
            color: #7e8ea0;
            margin-bottom: 4px;
            font-weight: normal;
        }

        .race-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid #4fc3f7;
        }

        .race-header {
            margin-bottom: 15px;
        }

        .race-title {
            font-size: 17px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ãƒˆãƒ©ãƒƒã‚¯è‰²åˆ†ã‘ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .track-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .track-badge.èŠ {
            background: rgba(76,175,80,0.2);
            color: #81c784;
        }

        .track-badge.ãƒ€ {
            background: rgba(255,152,0,0.2);
            color: #ffb74d;
        }

        /* è·é›¢ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .distance-icon {
            font-size: 14px;
        }

        .race-info {
            font-size: 13px;
            color: #b0c4de;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ç™ºèµ°æ™‚åˆ»ã®å¼·èª¿è¡¨ç¤º */
        .start-time {
            font-size: 15px;
            font-weight: 600;
            color: #4fc3f7;
            padding: 4px 10px;
            background: rgba(79,195,247,0.15);
            border-radius: 8px;
        }

        .turbulence-badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .turbulence-badge.ä½ { background: rgba(76,175,80,0.2); color: #81c784; }
        .turbulence-badge.ä¸­ { background: rgba(255,193,7,0.2); color: #ffd54f; }
        .turbulence-badge.é«˜ { background: rgba(244,67,54,0.2); color: #e57373; }

        .horse-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
        }

        .horse-card.expandable {
            cursor: pointer;
            transition: background 0.2s;
        }

        .horse-card.expandable:hover {
            background: rgba(255,255,255,0.08);
        }

        .horse-main-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rank-badge {
            font-size: 22px;
            min-width: 40px;
            text-align: center;
        }

        .horse-info {
            flex: 1;
        }

        .horse-name {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 5px;
        }

        .horse-score {
            font-size: 16px;
            font-weight: 700;
            color: #4fc3f7;
        }

        /* æ ¹æ‹ è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .horse-reason {
            font-size: 12px;
            color: #b0c4de;
            margin-top: 6px;
            padding-left: 52px;
        }

        /* ã‚¹ã‚³ã‚¢å†…è¨³å±•é–‹ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .score-breakdown {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: rgba(79,195,247,0.1);
            border-radius: 8px;
            border-left: 3px solid #4fc3f7;
        }

        .score-breakdown.expanded {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .breakdown-title {
            font-size: 12px;
            color: #4fc3f7;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .breakdown-item {
            margin-bottom: 8px;
        }

        .breakdown-label {
            font-size: 11px;
            color: #b0c4de;
            margin-bottom: 4px;
        }

        .breakdown-bar-container {
            background: rgba(255,255,255,0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .breakdown-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-out;
            background: linear-gradient(90deg, #00bcd4 0%, #2196f3 100%);
        }

        .breakdown-value {
            font-size: 11px;
            color: #fff;
            font-weight: 600;
            margin-top: 2px;
        }

        .dark-horses-section {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 14px;
            margin-top: 12px;
        }

        .dark-horses-title {
            font-size: 13px;
            font-weight: 600;
            color: #ffd54f;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dark-horses-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .dark-horse-item {
            font-size: 13px;
            color: #b0c4de;
            padding: 6px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-horse-score {
            font-size: 12px;
            color: #4fc3f7;
            font-weight: 600;
        }

        .betting-section {
            background: rgba(79,195,247,0.1);
            border-radius: 8px;
            padding: 14px;
            margin-top: 12px;
        }

        .betting-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .betting-title {
            font-size: 13px;
            font-weight: 600;
            color: #4fc3f7;
        }

        .expand-icon {
            font-size: 14px;
            color: #4fc3f7;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .expand-icon.expanded {
            transform: rotate(180deg);
        }

        .betting-method {
            font-size: 12px;
            color: #b0c4de;
            margin-bottom: 8px;
        }

        .betting-investment {
            font-size: 14px;
            color: #fff;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .betting-combinations {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .combination {
            background: rgba(255,255,255,0.1);
            padding: 7px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #fff;
        }

        /* æŠ•è³‡é¡å†…è¨³å±•é–‹ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .investment-breakdown {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 6px;
        }

        .investment-breakdown.expanded {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .investment-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
        }

        .investment-item:last-child {
            border-bottom: none;
        }

        .investment-label {
            color: #b0c4de;
        }

        .investment-value {
            color: #fff;
            font-weight: 600;
        }

        .result-badge {
            display: inline-block;
            padding: 7px 16px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .result-badge.hit { background: rgba(76,175,80,0.2); color: #81c784; }
        .result-badge.miss { background: rgba(244,67,54,0.2); color: #e57373; }

        .result-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .result-item {
            text-align: center;
            padding: 14px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .result-label {
            font-size: 12px;
            color: #b0c4de;
            margin-bottom: 6px;
        }

        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
        }

        .result-value.profit { color: #81c784; }
        .result-value.loss { color: #e57373; }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid rgba(79,195,247,0.2);
            border-top-color: #4fc3f7;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #b0c4de;
            font-size: 15px;
        }

        .error-message {
            background: rgba(244,67,54,0.15);
            border: 1px solid rgba(244,67,54,0.3);
            color: #e57373;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
        }

.report-type-selector {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    justify-content: center;
    flex-wrap: wrap;
}

.report-type-btn {
    padding: 12px 24px;
    background: #1a2332;
    border: 2px solid #2c3e50;
    border-radius: 8px;
    color: #b0c4de;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.report-type-btn:hover {
    background: #2c3e50;
    border-color: #4fc3f7;
    color: #4fc3f7;
}

.report-type-btn.active {
    background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
    border-color: #4fc3f7;
    color: #fff;
    box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
}

.report-container {
    background: #1a2332;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.report-header {
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #2c3e50;
}

.report-title {
    font-size: 24px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 8px;
}

.report-period {
    font-size: 14px;
    color: #7e8ea0;
}

.report-section {
    margin-bottom: 32px;
}

.report-section-title {
    font-size: 18px;
    font-weight: 700;
    color: #4fc3f7;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
}

/* KPIã‚«ãƒ¼ãƒ‰å°‚ç”¨ã‚°ãƒªãƒƒãƒ‰ï¼ˆçµ±è¨ˆãƒšãƒ¼ã‚¸ç”¨ï¼‰ */
.stats-kpi-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 16px;
}

.summary-card {
    background: linear-gradient(135deg, #2c3e50 0%, #1a2332 100%);
    padding: 12px 8px;
    border-radius: 8px;
    border: 1px solid rgba(79, 195, 247, 0.2);
    text-align: center;
}

.summary-label {
    font-size: 10px;
    /* ãƒ©ãƒ™ãƒ«è‰²: ãƒšãƒ¼ã‚¸é…è‰²ã«åˆã‚ã›ãŸè–„ã„ãƒ–ãƒ«ãƒ¼ã‚°ãƒ¬ãƒ¼ */
    color: #8fa8c0;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.summary-value {
    font-size: 18px;
    font-weight: 700;
    color: #fff;
    text-align: center;
}

.summary-value.positive {
    color: #4caf50;
}

.summary-value.negative {
    color: #f44336;
}

.segment-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
}

.segment-table thead {
    background: #2c3e50;
}

.segment-table th {
    padding: 12px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    color: #b0c4de;
    border-bottom: 2px solid #4fc3f7;
}

.segment-table td {
    padding: 12px;
    border-bottom: 1px solid #2c3e50;
    font-size: 14px;
}

.segment-table tr:hover {
    background: rgba(79, 195, 247, 0.1);
}

.insight-item {
    background: linear-gradient(135deg, #2c3e50 0%, #1a2332 100%);
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 12px;
    border-left: 4px solid #4fc3f7;
}

.insight-item.positive {
    border-left-color: #4caf50;
}

.insight-item.warning {
    border-left-color: #ff9800;
}

.insight-message {
    font-size: 14px;
    color: #e0e0e0;
}

.pace-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin-top: 12px;
}

.pace-card {
    background: linear-gradient(135deg, #2c3e50 0%, #1a2332 100%);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #2c3e50;
}

.pace-name {
    font-size: 16px;
    font-weight: 700;
    color: #4fc3f7;
    margin-bottom: 12px;
}

.pace-stat {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 13px;
}

.pace-stat-label {
    color: #7e8ea0;
}

.pace-stat-value {
    color: #fff;
    font-weight: 600;
}

.runstyle-breakdown {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #2c3e50;
}

.runstyle-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 12px;
}

.runstyle-name {
    color: #b0c4de;
}

.runstyle-hitrate {
    color: #4fc3f7;
    font-weight: 600;
}

@media (max-width: 768px) {
    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .pace-grid {
        grid-template-columns: 1fr;
    }
    
    .segment-table {
        font-size: 12px;
    }
    
    .segment-table th,
    .segment-table td {
        padding: 8px;
    }
}


/* çµ±è¨ˆãƒ†ãƒ¼ãƒ–ãƒ«ã®td */
#daily-tbody td,
#venue-tbody td,
#track-tbody td {
    padding: 5px 4px;
    font-size: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}
    </style>
</head>
<body>
    <div class="header">
        <div class="title">DES_AIç«¶é¦¬äºˆæƒ³</div>
        <div class="subtitle">ãƒ‡ãƒ¥ã‚¢ãƒ«ãƒ»ã‚¨ãƒƒã‚¸ãƒ»ã‚·ã‚¹ãƒ†ãƒ </div>
        <div class="subtitle">é€±å˜ä½ãƒ—ãƒ©ã‚¹åæ”¯ã‚’ç›®æŒ‡ã™</div>
        <div class="subtitle">AIæˆ¦ç•¥äºˆæƒ³</div>
        <a href="https://x.com/AIkeibayosouDES" target="_blank" class="x-link">
            å…¬å¼X: @AIkeibayosouDES
        </a>
    </div>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('predictions')">
            <span class="tab-label">äºˆæƒ³</span>
            <span class="tab-icon">ğŸ“Š</span>
        </button>
        <button class="tab-btn" onclick="switchTab('results')">
            <span class="tab-label">çµæœ</span>
            <span class="tab-icon">ğŸ¯</span>
        </button>
        <button class="tab-btn" onclick="switchTab('stats')">
            <span class="tab-label">çµ±è¨ˆ</span>
            <span class="tab-icon">ğŸ“ˆ</span>
        </button>
        <button class="tab-btn" onclick="switchTab('reports')">
            <span class="tab-label">ãƒ¬ãƒãƒ¼ãƒˆ</span>
            <span class="tab-icon">ğŸ“‹</span>
        </button>
    </div>

    <div class="content">
        <div id="predictions-tab" class="tab-content active">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>
            </div>
        </div>

        <div id="results-tab" class="tab-content">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">çµæœãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>
            </div>
        </div>

        <div id="stats-tab" class="tab-content">
            <div class="section-header">
                <div class="section-title">ğŸ“ˆ çµ±è¨ˆ</div>
                <button class="refresh-btn" onclick="loadStatistics()" style="margin-left: auto;">ğŸ”„ æ›´æ–°</button>
            </div>
       
            <div class="stats-kpi-grid">
                <div class="summary-card">
                    <div class="summary-label">ç·ãƒ¬ãƒ¼ã‚¹æ•°</div>
                    <div class="summary-value" id="stat-total-races" style="color: #4fc3f7;">-</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">çš„ä¸­æ•°</div>
                    <div class="summary-value" id="stat-total-hits" style="color: #4fc3f7;">-</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">çš„ä¸­ç‡</div>
                    <div class="summary-value" id="stat-hit-rate" style="color: #4fc3f7;">-%</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">å›åç‡</div>
                    <div class="summary-value" id="stat-recovery-rate" style="color: #4fc3f7;">-%</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">æŠ•è³‡é¡</div>
                    <div class="summary-value" id="stat-investment" style="color: #4fc3f7;">-</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">åæ”¯</div>
                    <div class="summary-value" id="stat-profit" style="color: #4fc3f7;">-</div>
                </div>
            </div>

            <div class="summary-card" style="margin-bottom: 10px;">
                <div class="summary-label" style="font-size: 14px; font-weight: 700; margin-bottom: 8px;">ğŸ“… æ—¥åˆ¥æˆç¸¾</div>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <th style="padding: 6px 4px; text-align: left; color: #4fc3f7; font-size: 11px;">æ—¥ä»˜</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">Ræ•°</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­ç‡</th>
                                <th style="padding: 6px 4px; text-align: right; color: #4fc3f7; font-size: 11px;">æŠ•è³‡é¡</th>
                                <th style="padding: 6px 4px; text-align: right; color: #4fc3f7; font-size: 11px;">åæ”¯</th>
                            </tr>
                        </thead>
                        <tbody id="daily-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="summary-card" style="margin-bottom: 10px;">
                <div class="summary-label" style="font-size: 14px; font-weight: 700; margin-bottom: 8px;">ğŸ‡ ç«¶é¦¬å ´åˆ¥æˆç¸¾</div>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <th style="padding: 6px 4px; text-align: left; color: #4fc3f7; font-size: 11px;">ç«¶é¦¬å ´</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">Ræ•°</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­ç‡</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">å›åç‡</th>
                            </tr>
                        </thead>
                        <tbody id="venue-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="summary-card">
                <div class="summary-label" style="font-size: 14px; font-weight: 700; margin-bottom: 8px;">ğŸ ãƒˆãƒ©ãƒƒã‚¯åˆ¥æˆç¸¾</div>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <th style="padding: 6px 4px; text-align: left; color: #4fc3f7; font-size: 11px;">ãƒˆãƒ©ãƒƒã‚¯</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">Ræ•°</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">çš„ä¸­ç‡</th>
                                <th style="padding: 6px 4px; text-align: center; color: #4fc3f7; font-size: 11px;">å›åç‡</th>
                            </tr>
                        </thead>
                        <tbody id="track-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="reports-tab" class="tab-content">
       <div class="section-title">ğŸ“Š åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</div>
    
       <div class="report-type-selector">
        <button class="report-type-btn active" onclick="loadReport('daily')">ğŸ“… æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</button>
        <button class="report-type-btn" onclick="loadReport('weekly')">ğŸ“Š é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</button>
               <button class="report-type-btn" onclick="loadReport('monthly')">ğŸ“ˆ æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</button>
                </div>
    
            <div id="report-container" class="report-container">
            <div class="loading">ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
                </div>
    </div>

    <script>
        let predictionsData = null;
        let resultsData = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadPredictions();
            loadResults();
        });

        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.getAttribute('onclick').includes(tabName)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const targetContent = document.getElementById(`${tabName}-tab`);
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            if (tabName === 'stats') {
                loadStatistics();
                } else if (tabName === 'reports') {
                    initReports();
                }
           }

        async function loadPredictions() {
            try {
                console.log('Loading predictions...');
                
                document.getElementById('predictions-tab').innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ä¸­...</div>
                    </div>
                `;
                
                const url = `https://raw.githubusercontent.com/aipapa247272/keiba-auto-gist-updater/main/latest_predictions.json?t=${Date.now()}`;
                const response = await fetch(url, { cache: 'no-cache' });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                predictionsData = await response.json();
                console.log('Predictions data:', predictionsData);
                renderPredictions(predictionsData);
            } catch (error) {
                console.error('äºˆæƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('predictions-tab').innerHTML = `
                    <div class="error-message">
                        âŒ äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                        <button class="refresh-btn" onclick="loadPredictions()" style="margin-top: 15px; display: block; margin-left: auto; margin-right: auto;">
                            ğŸ”„ å†è©¦è¡Œ
                        </button>
                    </div>
                `;
            }
        }

        async function loadResults() {
            try {
                console.log('Loading results...');
                
                document.getElementById('results-tab').innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">çµæœãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ä¸­...</div>
                    </div>
                `;
                
                const url = `https://raw.githubusercontent.com/aipapa247272/keiba-auto-gist-updater/main/latest_results.json?t=${Date.now()}`;
                const response = await fetch(url, { cache: 'no-cache' });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                resultsData = await response.json();
                console.log('Results data:', resultsData);
                renderResults(resultsData);
            } catch (error) {
                console.error('çµæœãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('results-tab').innerHTML = `
                    <div class="error-message">
                        âŒ çµæœãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                        <button class="refresh-btn" onclick="loadResults()" style="margin-top: 15px; display: block; margin-left: auto; margin-right: auto;">
                            ğŸ”„ å†è©¦è¡Œ
                        </button>
                    </div>
                `;
            }
        }

        function formatDate(ymd) {
            if (!ymd) return '-';
            const str = String(ymd);
            return str.replace(/(\d{4})(\d{2})(\d{2})/, '$1/$2/$3');
        }

        function extractRaceNumber(raceId) {
            if (!raceId || typeof raceId !== 'string') return '-';
            const match = raceId.match(/\d{2}(\d{2})$/);
            return match ? match[1] : '-';
        }

        function getDistanceIcon(distance) {
            if (!distance) return '';
            const dist = parseInt(distance);
            if (dist < 1400) return 'âš¡'; // çŸ­è·é›¢
            if (dist < 1800) return 'ğŸƒ'; // ãƒã‚¤ãƒ«
            if (dist < 2200) return 'ğŸ'; // ä¸­è·é›¢
            return 'ğŸ‡'; // é•·è·é›¢
        }

        function toggleScoreBreakdown(raceId, horseNum) {
            const element = document.getElementById(`breakdown-${raceId}-${horseNum}`);
            if (element) {
                element.classList.toggle('expanded');
            }
        }

        function toggleInvestmentBreakdown(raceId) {
            const element = document.getElementById(`investment-${raceId}`);
            const icon = document.getElementById(`expand-icon-${raceId}`);
            if (element && icon) {
                element.classList.toggle('expanded');
                icon.classList.toggle('expanded');
            }
        }

        function renderPredictions(data) {
            const container = document.getElementById('predictions-tab');

            // ===== ğŸ†• é–‹å‚¬ãªã—ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å¯¾å¿œ =====
            if (data.no_race) {
                const noRaceType = data.no_race_type || 'no_race';
                const noRaceReason = data.no_race_reason || 'æœ¬æ—¥ã¯ç«¶é¦¬ã®é–‹å‚¬ãŒã‚ã‚Šã¾ã›ã‚“';
                const targetDate = data.ymd || '';
                const updateTime = data.generated_at || '';
                
                let icon = 'ğŸš«';
                let bgColor = '#1a2744';
                let borderColor = '#3a4d7a';
                if (noRaceType === 'maintenance') {
                    icon = 'ğŸ”§';
                    bgColor = '#1a2233';
                    borderColor = '#4a5d8a';
                }
                
                container.innerHTML = `
                    <div class="section-header">
                        <div class="section-title">ğŸ“Š ä»Šæ—¥ã®äºˆæƒ³</div>
                        <button class="refresh-btn" onclick="loadPredictions()">ğŸ”„ æ›´æ–°</button>
                    </div>
                    <div class="update-info">
                        <div class="update-label">ğŸ“… ãƒ‡ãƒ¼ã‚¿å–å¾—æ—¥æ™‚</div>
                        <div class="update-time">${updateTime}</div>
                    </div>
                    <div style="
                        background: ${bgColor};
                        border: 2px solid ${borderColor};
                        border-radius: 12px;
                        padding: 30px 20px;
                        text-align: center;
                        margin: 20px 0;
                    ">
                        <div style="font-size: 3em; margin-bottom: 12px;">${icon}</div>
                        <div style="font-size: 1.2em; font-weight: bold; color: #90caf9; margin-bottom: 8px;">
                            ${formatDate(targetDate)} ã®ç«¶é¦¬
                        </div>
                        <div style="font-size: 1em; color: #b0bec5; line-height: 1.6;">
                            ${noRaceReason}
                        </div>
                    </div>
                `;
                return;
            }
            // ===== é–‹å‚¬ãªã—å‡¦ç†çµ‚ã‚ã‚Š =====

            const races = data.selected_predictions || [];
            const summary = data.summary || {};
            const turbulence = summary.turbulence || {};

            // é–‹å‚¬æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆ
            races.sort((a, b) => {
                const timeA = a.start_time || '00:00';
                const timeB = b.start_time || '00:00';
                return timeA.localeCompare(timeB);
            });

            const selectedRacesCount = data.selected_races || races.length;
            const totalRacesCount = data.total_races || 0;
            const totalInvestment = summary.total_investment || 0;
            const updateTime = data.generated_at || new Date().toLocaleString('ja-JP');
            const targetDate = data.ymd || '';

            let html = `
                <div class="section-header">
                    <div class="section-title">ğŸ“Š ä»Šæ—¥ã®äºˆæƒ³</div>
                    <button class="refresh-btn" onclick="loadPredictions()">ğŸ”„ æ›´æ–°</button>
                </div>

                <div class="update-info">
                    <div class="update-label">ğŸ“… ãƒ‡ãƒ¼ã‚¿å–å¾—æ—¥æ™‚</div>
                    <div class="update-time">${updateTime}</div>
                </div>

                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-label">å¯¾è±¡æ—¥</div>
                        <div class="summary-value">${formatDate(targetDate)}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">AIé¸å®šãƒ¬ãƒ¼ã‚¹</div>
                        <div class="summary-value">${selectedRacesCount}R</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">å…¨ãƒ¬ãƒ¼ã‚¹æ•°</div>
                        <div class="summary-value">${totalRacesCount}R</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">æŠ•è³‡é¡</div>
                        <div class="summary-value">Â¥${totalInvestment.toLocaleString()}</div>
                    </div>
                </div>

                <div class="turbulence-grid">
                    <div class="turbulence-item">
                        <div class="turbulence-label">ğŸŸ¢ ä½</div>
                        <div class="turbulence-value" style="color: #81c784;">${turbulence.ä½ || 0}</div>
                    </div>
                    <div class="turbulence-item">
                        <div class="turbulence-label">ğŸŸ¡ ä¸­</div>
                        <div class="turbulence-value" style="color: #ffd54f;">${turbulence.ä¸­ || 0}</div>
                    </div>
                    <div class="turbulence-item">
                        <div class="turbulence-label">ğŸ”´ é«˜</div>
                        <div class="turbulence-value" style="color: #e57373;">${turbulence.é«˜ || 0}</div>
                    </div>
                </div>

                <div class="turbulence-legend">
                    <div class="legend-title">ã€æ³¢ä¹±åº¦ã®èª¬æ˜ã€‘</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-icon">ğŸŸ¢</span>
                            <span class="legend-text">ä½: æœ¬å‘½æœ‰åˆ©ï¼ˆæ–°ã‚¹ã‚³ã‚¢ä¸Šä½3é ­å¹³å‡â‰¥70ç‚¹ã€å·®â‰¥10ç‚¹ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">ğŸŸ¡</span>
                            <span class="legend-text">ä¸­: æ‹®æŠ—ï¼ˆå¹³å‡â‰¥55ç‚¹ or å·®â‰¥5ç‚¹ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">ğŸ”´</span>
                            <span class="legend-text">é«˜: å¤§æ··æˆ¦ï¼ˆãã‚Œä»¥å¤–ï¼‰</span>
                        </div>
                    </div>
                </div>
            `;

            races.forEach((race, index) => {
                const raceNum = extractRaceNumber(race.race_id);
                const venue = race.venue || '-';
                const raceName = race.race_name || `${raceNum}R`;
                const track = race.track || '-';
                const distance = race.distance || '-';
                const distanceIcon = getDistanceIcon(distance);
                const startTime = race.start_time || '-';
                const turbLevel = race.turbulence || '-';
                const investment = race.investment || 0;

                const topHorses = race.betting_plan?.è»¸ || [];
                const darkHorses = race.betting_plan?.ç›¸æ‰‹ || [];
                
                // ç©´å€™è£œã®é ­æ•°ã‚’è¨ˆç®—ï¼ˆå‡ºé¦¬æ•°Ã·2+1ï¼‰
                const totalHorses = (topHorses.length + darkHorses.length) || 0;
                const expectedDarkHorses = Math.floor(totalHorses / 2) + 1;
                
                html += `
                    <div class="race-card">
                        <div class="race-header">
                            <div class="race-number">AIäºˆæƒ³ãƒ¬ãƒ¼ã‚¹${index + 1}</div>
                            <div class="race-title">
                                ${venue} ${raceNum}R ${raceName}
                            </div>
                            <div class="race-info">
                                <span class="track-badge ${track}">${track}</span>
                                <span>${distanceIcon} ${distance}m</span>
                                <span class="start-time">ğŸ• ${startTime}</span>
                            </div>
                            <div class="turbulence-badge ${turbLevel}">${turbLevel}</div>
                        </div>
                `;

                topHorses.slice(0, 3).forEach(horse => {
                    const rank = horse.è©•ä¾¡ || '-';
                    const score = Math.round((horse.ã‚¹ã‚³ã‚¢ || 0) * 10) / 10;
                    const horseNum = horse.é¦¬ç•ª || '-';
                    const horseName = horse.é¦¬å || '-';
                    const reason = horse.æ ¹æ‹  || '';
                    const breakdown = horse.å†…è¨³ || horse['ã‚¹ã‚³ã‚¢å†…è¨³'] || horse['æ–°ã‚¹ã‚³ã‚¢_å†…è¨³'] || {};
                    
                    html += `
                        <div class="horse-card expandable" onclick="toggleScoreBreakdown('${race.race_id}', ${horseNum})">
                            <div class="horse-main-info">
                                <div class="rank-badge">${rank}</div>
                                <div class="horse-info">
                                    <div class="horse-name">${horseNum}ç•ª:${horseName}</div>
                                    <div class="horse-score">${score}/100</div>
                                </div>
                            </div>
                    `;
                    
                    if (reason) {
                        html += `<div class="horse-reason">ğŸ’¡ ${reason}</div>`;
                    }
                    
                    if (Object.keys(breakdown).length > 0) {
                        html += `
                            <div class="score-breakdown" id="breakdown-${race.race_id}-${horseNum}">
                                <div class="breakdown-title">ğŸ“Š ã‚¹ã‚³ã‚¢å†…è¨³</div>
                        `;
                        
                        Object.keys(breakdown).forEach(key => {
                            const value = breakdown[key] || 0;
                            html += `
                                <div class="breakdown-item">
                                    <div class="breakdown-label">${key}</div>
                                    <div class="breakdown-bar-container">
                                        <div class="breakdown-bar" style="width: ${value}%"></div>
                                    </div>
                                    <div class="breakdown-value">${value}/100</div>
                                </div>
                            `;
                        });
                        
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                });

                if (darkHorses && darkHorses.length > 0) {
                    html += `
                        <div class="dark-horses-section">
                            <div class="dark-horses-title">ğŸ”¸ ç©´å€™è£œ â–³ (${darkHorses.length}é ­)</div>
                            <div class="dark-horses-list">
                    `;
                    
                    darkHorses.forEach(horse => {
                        const horseNum = horse.é¦¬ç•ª || '-';
                        const horseName = horse.é¦¬å || '-';
                        const score = horse.ã‚¹ã‚³ã‚¢ ? Math.round(horse.ã‚¹ã‚³ã‚¢ * 10) / 10 : '';
                        html += `
                            <div class="dark-horse-item">
                                <span>${horseNum}ç•ª:${horseName}</span>
                                ${score ? `<span class="dark-horse-score">${score}</span>` : ''}
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }

                const bettingType = race.betting_plan?.è²·ã„ç›®ã‚¿ã‚¤ãƒ— || 'ä¸‰é€£è¤‡ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³';
                const axisNums = topHorses.map(h => h.é¦¬ç•ª).filter(n => n);
                const partnerNums = darkHorses.map(h => h.é¦¬ç•ª).filter(n => n);
                
                html += `
                    <div class="betting-section">
                        <div class="betting-header">
                            <div class="betting-title">ğŸ’° è²·ã„ç›®ææ¡ˆ</div>
                            <div class="expand-icon" id="expand-icon-${race.race_id}" onclick="toggleInvestmentBreakdown('${race.race_id}')">â–¼</div>
                        </div>
                        <div class="betting-method">ğŸ“ ${bettingType}</div>
                        <div class="betting-investment">æŠ•è³‡é¡: Â¥${investment.toLocaleString()}</div>
                        
                        <div class="investment-breakdown" id="investment-${race.race_id}">
                            <div class="investment-item">
                                <span class="investment-label">1ç‚¹ã‚ãŸã‚Š</span>
                                <span class="investment-value">Â¥100</span>
                            </div>
                            <div class="investment-item">
                                <span class="investment-label">çµ„ã¿åˆã‚ã›æ•°</span>
                                <span class="investment-value">${(investment / 100).toFixed(0)}é€šã‚Š</span>
                            </div>
                            <div class="investment-item">
                                <span class="investment-label">åˆè¨ˆ</span>
                                <span class="investment-value">Â¥${investment.toLocaleString()}</span>
                            </div>
                        </div>
                `;

                if (axisNums.length > 0) {
                    html += `
                        <div style="margin-bottom: 8px;">
                            <span style="color: #4fc3f7; font-size: 12px;">è»¸:</span>
                            <div class="betting-combinations">
                    `;
                    axisNums.forEach(num => {
                        html += `<div class="combination">${num}ç•ª</div>`;
                    });
                    html += `</div></div>`;
                }

                if (partnerNums.length > 0) {
                    html += `
                        <div>
                            <span style="color: #4fc3f7; font-size: 12px;">ç›¸æ‰‹:</span>
                            <div class="betting-combinations">
                    `;
                    partnerNums.forEach(num => {
                        html += `<div class="combination">${num}ç•ª</div>`;
                    });
                    html += `</div></div>`;
                }

                html += `
                        </div>
                    </div>
                `;
            });

            document.getElementById('predictions-tab').innerHTML = html;
        }

        function renderResults(data) {
            const races = data.races || [];
            const targetDate = data.date || data.ymd || '';
            const totalRaces = data.total_races || races.length;
            const hitCount = data.hit_count || 0;
            const totalInvestment = data.total_investment || 0;
            const totalProfit = data.total_profit || 0;
            const hitRate = data.hit_rate || 0;

            let html = `
                <div class="section-header">
                    <div class="section-title">ğŸ¯ æ˜¨æ—¥ã®çµæœ</div>
                    <button class="refresh-btn" onclick="loadResults()">ğŸ”„ æ›´æ–°</button>
                </div>

                <div class="update-info">
                    <div class="update-label">ğŸ“… å¯¾è±¡æ—¥</div>
                    <div class="update-time">${formatDate(targetDate)}</div>
                </div>

                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-label">å¯¾è±¡ãƒ¬ãƒ¼ã‚¹</div>
                        <div class="summary-value">${totalRaces}R</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">çš„ä¸­æ•°</div>
                        <div class="summary-value">${hitCount}R</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">çš„ä¸­ç‡</div>
                        <div class="summary-value">${hitRate.toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">åæ”¯</div>
                        <div class="summary-value ${totalProfit >= 0 ? 'profit' : 'loss'}">
                            ${totalProfit >= 0 ? '+' : ''}Â¥${totalProfit.toLocaleString()}
                        </div>
                    </div>
                </div>
                ${(() => {
                    let vbTotal = 0;
                    races.forEach(r => {
                        Object.values(r.virtual_bets_result||{}).forEach(v => { vbTotal += (v['åæ”¯']||0); });
                    });
                    const vc = vbTotal>=0?'#4caf50':'#ef5350';
                    return races.some(r=>Object.keys(r.virtual_bets_result||{}).length>0)
                        ? `<div style="margin-top:8px;padding:10px 14px;background:rgba(100,181,246,0.08);border-radius:8px;border:1px solid rgba(100,181,246,0.25);display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-size:12px;color:#64b5f6;">ğŸ§ª ä»®æƒ³åæ”¯åˆè¨ˆï¼ˆè¤‡å‹+ãƒ¯ã‚¤ãƒ‰+é¦¬é€£ï¼‰</span>
                            <span style="font-size:14px;font-weight:700;color:${vc};">${vbTotal>=0?'+':''}Â¥${vbTotal.toLocaleString()}</span>
                           </div>`
                        : '';
                })()}
            `;

            if (races.length === 0) {
                html += `
                    <div class="error-message" style="background: rgba(158,158,158,0.15); border-color: rgba(158,158,158,0.3); color: #bdbdbd;">
                        ğŸ“­ æ˜¨æ—¥ã®çµæœãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
                    </div>
                `;
            } else {
                // â‘  é–‹å‚¬æ™‚é–“é †ã«ã‚½ãƒ¼ãƒˆï¼ˆstart_time ãŒãªã„å ´åˆã¯ race_num é †ï¼‰
                races.sort((a, b) => {
                    const ta = a.start_time || '99:99';
                    const tb = b.start_time || '99:99';
                    if (ta !== tb) return ta.localeCompare(tb);
                    return String(a.race_num || '').localeCompare(String(b.race_num || ''));
                });
                races.forEach(result => {
                    const statusText = result.hit ? 'ğŸ¯ çš„ä¸­' : 'âŒ ä¸çš„ä¸­';
                    const statusClass = result.hit ? 'hit' : 'miss';
                    
                    const raceNum = result.race_num || extractRaceNumber(result.race_id);
                    const venue = result.venue || '-';
                    const raceName = result.race_name || `${raceNum}R`;
                    const distance = result.distance ? `${result.track}${result.distance}m` : '-';
                    // score_tier ãƒãƒƒã‚¸
                    const tierColors = {S:'#ff4081',A:'#ff9800',B:'#4caf50',C:'#78909c'};
                    const tierBadge = result.score_tier
                        ? `<span style="background:${tierColors[result.score_tier]||'#78909c'};color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:4px;margin-left:6px;">${result.score_tier}tier</span>`
                        : '';
                    const predictedArray = Array.isArray(result.predicted) ? result.predicted : [];
                    const predicted = predictedArray.join(', ') || '-';
                    // â‘¡ è»¸é¦¬ãƒ»ç©´é¦¬ã®æ–‡å­—åˆ—ã‚’æ§‹ç¯‰
                    const bettingPlan = result.betting_plan || {};
                    const axisHorses = bettingPlan['è»¸'] || [];
                    const opponentHorses = bettingPlan['ç›¸æ‰‹'] || [];
                    const evalMap = {'â—':'â—','â—‹':'â—¯','â–²':'â–³'};
                    const axisStr = axisHorses.map(h => (evalMap[h['è©•ä¾¡']] || '') + h['é¦¬ç•ª']).join('');
                    const opponentStr = opponentHorses.map(h => h['é¦¬ç•ª']).join('-');
                    const startTimeDisp = result.start_time || '-';
                    const actual = result.actual?.join(', ') || '-';
                    const investment = result.investment || 0;
                    const returnAmount = result.return || 0;
                    const profit = result.profit || 0;
                    const weather = result.weather || '-';
                    const trackCondition = result.track_condition || '-';
                    const payouts = result.payouts || {};
                    const horseWeights = result.horse_weights || [];
                    
                    html += `
                        <div class="race-card">
                            <div class="race-header">
                                <div class="race-title">${venue} ${raceNum}R ${raceName}${tierBadge}</div>
                                <div class="race-info">${distance} | ç™ºèµ° ${startTimeDisp}</div>
                            </div>
                            <div class="result-badge ${statusClass}">${statusText}</div>
                            
                            <div style="margin: 12px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <details style="font-size: 13px;">
                                    <summary style="color: #b0c4de; cursor: pointer; user-select: none; list-style: none; display: flex; align-items: flex-start; gap: 4px;">
                                        <span style="font-size: 11px; color: #90a4ae; margin-top: 2px;">â–¶</span>
                                        <div style="line-height: 1.9;">
                                            <div><span style="color: #ffd54f; font-weight: 600;">ğŸ“Šäºˆæƒ³:</span><span style="color: #e0e0e0;">è»¸</span><strong style="color: #4fc3f7; letter-spacing: 1px;">${axisStr || '-'}</strong></div>
                                            <div style="padding-left: 3.2em;"><span style="color: #e0e0e0;">ç©´ </span><strong style="color: #ce93d8;">${opponentStr || '-'}</strong></div>
                                            <div><span style="color: #a5d6a7; font-weight: 600;">ğŸ¯çµæœ:</span><strong style="color: #fff;">${actual}</strong></div>
                                            <div><span style="color: #ffcc80; font-weight: 600;">ğŸ’°è²·ã„ç›®:</span><strong style="color: #4fc3f7;">${predictedArray.length}ç‚¹è²·ã„</strong><span style="color: #78909c; font-size: 11px;">ï¼ˆã‚¿ãƒƒãƒ—ã§å±•é–‹ï¼‰</span></div>
                                        </div>
                                    </summary>
                                    <div style="margin-top: 8px; word-break: break-all; line-height: 1.8; padding-left: 1.2em;">
                                        ${(() => {
                                            const actualStr = (result.actual?.[0] || '').trim();
                                            const actualSet = new Set(actualStr ? actualStr.split('-') : []);
                                            return predictedArray.map(combo => {
                                                const comboSet = new Set(combo.split('-'));
                                                const isHit = actualSet.size === 3 && comboSet.size === 3
                                                    && [...actualSet].every(x => comboSet.has(x));
                                                return isHit
                                                    ? `<span style="color:#00e676;font-weight:bold;background:rgba(0,230,118,0.15);padding:1px 5px;border-radius:4px;border:1px solid rgba(0,230,118,0.4);">â­${combo}</span>`
                                                    : `<span style="color:#78909c;">${combo}</span>`;
                                            }).join('<span style="color:#546e7a;"> / </span>');
                                        })()}
                                    </div>
                                </details>
                            </div>
                            
                            <div class="result-details">
                                <div class="result-item">
                                    <div class="result-label">æŠ•è³‡é¡</div>
                                    <div class="result-value">Â¥${investment.toLocaleString()}</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">æ‰•æˆ»</div>
                                    <div class="result-value">
                                        ${returnAmount > 0 
                                            ? 'Â¥' + returnAmount.toLocaleString()
                                            : result.hit 
                                                ? '<span style="color:#ffb300;font-size:11px;">âš ï¸ å–å¾—ä¸­</span>'
                                                : 'Â¥0'}
                                    </div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">æç›Š</div>
                                    <div class="result-value ${profit >= 0 ? 'profit' : 'loss'}">
                                        ${profit >= 0 ? '+' : ''}Â¥${profit.toLocaleString()}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 12px; padding: 12px; background: rgba(33,150,243,0.1); border-radius: 8px;">
                                <div style="font-size: 12px; color: #4fc3f7; font-weight: 600; margin-bottom: 8px;">â˜€ï¸ ãƒ¬ãƒ¼ã‚¹ç’°å¢ƒ</div>
                                <div style="font-size: 13px; color: #b0c4de;">
                                    å¤©å€™: ${weather} | é¦¬å ´: ${trackCondition}
                                </div>
                            </div>
                    `;
                    
                    if (Object.keys(payouts).length > 0) {
                        html += `
                            <div style="margin-top: 12px; padding: 12px; background: rgba(255,193,7,0.1); border-radius: 8px;">
                                <div style="font-size: 12px; color: #ffd54f; font-weight: 600; margin-bottom: 10px;">ğŸ“Š æ‰•æˆ»é‡‘</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        `;
                        Object.keys(payouts).forEach(key => {
                            html += `
                                    <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 12px;">
                                        <span style="color: #b0c4de;">${key}</span>
                                        <span style="color: #fff; font-weight: 600;">Â¥${payouts[key].toLocaleString()}</span>
                                    </div>
                            `;
                        });
                        html += `
                                </div>
                            </div>
                        `;
                    }
                    
                    // â”€â”€â”€ ä»®æƒ³åæ”¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    const virtualBets = result.virtual_bets_result || {};
                    if (Object.keys(virtualBets).length > 0) {
                        const vbTypeLabel = {'è¤‡å‹_è»¸1':'è¤‡å‹â—','è¤‡å‹_è»¸2':'è¤‡å‹â—‹','ãƒ¯ã‚¤ãƒ‰_è»¸1-2':'ãƒ¯ã‚¤ãƒ‰â—â—‹','é¦¬é€£_è»¸1-2':'é¦¬é€£â—â—‹'};
                        let vbTotalProfit = 0;
                        Object.values(virtualBets).forEach(v => { vbTotalProfit += (v['åæ”¯'] || 0); });
                        html += `
                            <div style="margin-top:12px;padding:12px;background:rgba(100,181,246,0.1);border-radius:8px;border:1px solid rgba(100,181,246,0.3);">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                                    <div style="font-size:12px;color:#64b5f6;font-weight:600;">ğŸ§ª ä»®æƒ³åæ”¯ï¼ˆãƒ†ã‚¹ãƒˆæ¤œè¨¼ç”¨ï¼‰</div>
                                    <div style="font-size:11px;font-weight:700;color:${vbTotalProfit>=0?'#4caf50':'#ef5350'};">${vbTotalProfit>=0?'+':''}Â¥${vbTotalProfit.toLocaleString()}</div>
                                </div>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
                        `;
                        Object.entries(virtualBets).forEach(([key, v]) => {
                            const label = vbTypeLabel[key] || key;
                            const hitMark = v['çš„ä¸­'] ? 'âœ…' : 'âŒ';
                            const profitColor = v['åæ”¯'] >= 0 ? '#4caf50' : '#ef5350';
                            html += `
                                    <div style="padding:7px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:11px;">
                                        <div style="display:flex;justify-content:space-between;align-items:center;">
                                            <span style="color:#b0c4de;">${hitMark} ${label}</span>
                                            <span style="color:${profitColor};font-weight:700;">${v['åæ”¯']>=0?'+':''}Â¥${v['åæ”¯'].toLocaleString()}</span>
                                        </div>
                                        <div style="color:#78909c;font-size:10px;margin-top:2px;">æ‰•æˆ» Â¥${(v['æ‰•æˆ»']||0).toLocaleString()} / æŠ•è³‡ Â¥${(v['æŠ•è³‡']||100).toLocaleString()}</div>
                                    </div>
                            `;
                        });
                        html += `
                                </div>
                            </div>
                        `;
                    }
                    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                    if (horseWeights.length > 0) {
                        html += `
                            <div style="margin-top: 12px; padding: 12px; background: rgba(156,39,176,0.1); border-radius: 8px;">
                                <div style="font-size: 12px; color: #ce93d8; font-weight: 600; margin-bottom: 10px;">ğŸ‡ é¦¬ä½“é‡ï¼ˆä¸Šä½3é ­ï¼‰</div>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                        `;
                        horseWeights.slice(0, 3).forEach(hw => {
                            html += `
                                    <div style="display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 12px;">
                                        <span style="color: #ffd54f; font-weight: 600;">${hw.rank}ç€</span>
                                        <span style="color: #b0c4de;">${hw.horse_number}ç•ª</span>
                                        <span style="color: #fff; font-weight: 600;">${hw.weight}</span>
                                    </div>
                            `;
                        });
                        html += `
                                </div>
                            </div>
                        `;
                    }
                    
                    html += `</div>`;
                });
            }

            document.getElementById('results-tab').innerHTML = html;
        }

        async function loadStatistics() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/aipapa247272/keiba-auto-gist-updater/main/statistics.json?t=' + Date.now(), {cache: 'no-cache'});
                const data = await response.json();
                
                document.getElementById('stat-total-races').textContent = data.overall.total_races;
                document.getElementById('stat-total-hits').textContent = data.overall.total_hits;
                document.getElementById('stat-hit-rate').textContent = data.overall.hit_rate + '%';
                document.getElementById('stat-recovery-rate').textContent = data.overall.recovery_rate + '%';
                document.getElementById('stat-investment').textContent = 'Â¥' + data.overall.total_investment.toLocaleString();
                
                const profitColor = data.overall.total_profit >= 0 ? '#4caf50' : '#f44336';
                document.getElementById('stat-profit').innerHTML = `<span style="color: ${profitColor}">Â¥${data.overall.total_profit.toLocaleString()}</span>`;
                
                const dailyTbody = document.getElementById('daily-tbody');
                dailyTbody.innerHTML = '';
                data.daily.forEach(day => {
                    const row = dailyTbody.insertRow();
                    row.innerHTML = `
                        <td style="padding: 8px;">${day.date}</td>
                        <td style="padding: 8px; text-align: center;">${day.races}</td>
                        <td style="padding: 8px; text-align: center;">${day.hits}</td>
                        <td style="padding: 8px; text-align: center;">${day.hit_rate}%</td>
                        <td style="padding: 8px; text-align: right;">Â¥${day.investment.toLocaleString()}</td>
                        <td style="padding: 8px; text-align: right; color: ${day.profit >= 0 ? '#4caf50' : '#f44336'};">Â¥${day.profit.toLocaleString()}</td>
                    `;
                });
                
                const venueTbody = document.getElementById('venue-tbody');
                venueTbody.innerHTML = '';
                data.by_venue.forEach(venue => {
                    const row = venueTbody.insertRow();
                    row.innerHTML = `
                        <td style="padding: 8px;">${venue.venue}</td>
                        <td style="padding: 8px; text-align: center;">${venue.races}</td>
                        <td style="padding: 8px; text-align: center;">${venue.hits}</td>
                        <td style="padding: 8px; text-align: center;">${venue.hit_rate}%</td>
                        <td style="padding: 8px; text-align: center;">${venue.recovery_rate}%</td>
                    `;
                });
                
                const trackTbody = document.getElementById('track-tbody');
                trackTbody.innerHTML = '';
                data.by_track.forEach(track => {
                    const row = trackTbody.insertRow();
                    row.innerHTML = `
                        <td style="padding: 8px;">${track.track}</td>
                        <td style="padding: 8px; text-align: center;">${track.races}</td>
                        <td style="padding: 8px; text-align: center;">${track.hits}</td>
                        <td style="padding: 8px; text-align: center;">${track.hit_rate}%</td>
                        <td style="padding: 8px; text-align: center;">${track.recovery_rate}%</td>
                    `;
                });
                
            } catch (error) {
                console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
// ãƒ¬ãƒãƒ¼ãƒˆèª­ã¿è¾¼ã¿
async function loadReport(reportType) {
    const container = document.getElementById('report-container');
    container.innerHTML = '<div class="loading">ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
    
    // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
    document.querySelectorAll('.report-type-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    try {
        // ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ±ºå®š
        const today = new Date();
        let filename;
        if (reportType === 'daily') {
            filename = `daily_report_${formatReportDate(today, 'YYYYMMDD')}.json`;
        } else if (reportType === 'weekly') {
            const monday = getMonday(today);
            filename = `weekly_report_${formatReportDate(monday, 'YYYYMMDD')}.json`;
        } else if (reportType === 'monthly') {
            filename = `monthly_report_${formatReportDate(today, 'YYYYMM')}.json`;
        }
        
        const response = await fetch(`https://raw.githubusercontent.com/aipapa247272/keiba-auto-gist-updater/main/${filename}`);
        
        if (!response.ok) {
            throw new Error('ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
        
        const report = await response.json();
        renderReport(report);
        
    } catch (error) {
        container.innerHTML = `
            <div class="error-message">
                <div class="error-icon">âš ï¸</div>
                <div class="error-text">ãƒ¬ãƒãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>
                <div class="error-detail">${error.message}</div>
                <div class="error-hint">ãƒ¬ãƒãƒ¼ãƒˆãŒã¾ã ç”Ÿæˆã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</div>
            </div>
        `;
    }
}

// ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
function renderReport(report) {
    const container = document.getElementById('report-container');
    const summary = report.summary;
    
    let html = `
        <div class="report-header">
            <div class="report-title">${getReportTypeLabel(report.report_type)}</div>
            <div class="report-period">${getReportPeriod(report)}</div>
        </div>
    `;
    
    // ã‚µãƒãƒªãƒ¼
    if (summary) {




html += `
    <div class="report-section">
        <div class="report-section-title">ğŸ“Š ç·åˆæˆç¸¾</div>
        <div class="rpt-summary-grid">
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">ãƒ¬ãƒ¼ã‚¹æ•°</div>
                <div class="rpt-summary-value">${summary.total_races}</div>
            </div>
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">çš„ä¸­ç‡</div>
                <div class="rpt-summary-value ${summary.hit_rate >= 15 ? 'positive' : ''}">${summary.hit_rate}%</div>
            </div>
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">å›åç‡</div>
                <div class="rpt-summary-value ${summary.recovery_rate >= 100 ? 'positive' : ''}">${summary.recovery_rate}%</div>
            </div>
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">åæ”¯</div>
                <div class="rpt-summary-value ${summary.profit >= 0 ? 'positive' : 'negative'}">Â¥${summary.profit.toLocaleString()}</div>
            </div>
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">æŠ•è³‡é¡</div>
                <div class="rpt-summary-value">Â¥${summary.total_investment.toLocaleString()}</div>
            </div>
            <div class="rpt-summary-card">
                <div class="rpt-summary-label">æ‰•æˆ»é¡</div>
                <div class="rpt-summary-value">Â¥${summary.total_payout.toLocaleString()}</div>
            </div>
        </div>
    </div>
`;

    }
    
    // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥åˆ†æ
    if (report.performance_by_segment || report.segment_performance) {
        const segments = report.performance_by_segment || report.segment_performance;
        html += renderSegmentAnalysis(segments);
    }
    
    // ãƒ¬ãƒ¼ã‚¹å±•é–‹åˆ†æ
    if (report.pace_analysis) {
        html += renderPaceAnalysis(report.pace_analysis);
    }
    
    // ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
    if (report.insights && report.insights.length > 0) {
        html += `
            <div class="report-section">
                <div class="report-section-title">ğŸ’¡ ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</div>
                ${report.insights.map(insight => `
                    <div class="insight-item ${insight.type}">
                        <div class="insight-message">${insight.message}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    // æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    if (report.recommendations && report.recommendations.length > 0) {
        html += `
            <div class="report-section">
                <div class="report-section-title">ğŸ¯ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                ${report.recommendations.map(rec => `
                    <div class="insight-item">
                        <div class="summary-label">${rec.category}</div>
                        <div class="insight-message">${rec.suggestion}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†æè¡¨ç¤º
function renderSegmentAnalysis(segments) {
    let html = '<div class="report-section"><div class="report-section-title">ğŸ“ˆ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥åˆ†æ</div>';
    
    const segmentLabels = {
        'by_num_horses': 'å‡ºé¦¬æ•°åˆ¥',
        'by_track': 'ãƒˆãƒ©ãƒƒã‚¯åˆ¥',
        'by_distance_category': 'è·é›¢ã‚«ãƒ†ã‚´ãƒªåˆ¥',
        'by_turbulence': 'æ··æ²Œåº¦åˆ¥',
        'by_venue': 'ä¼šå ´åˆ¥',
        'by_hole_count': 'ç©´å€™è£œé ­æ•°åˆ¥'
    };
    
    for (const [key, data] of Object.entries(segments)) {
        if (Object.keys(data).length === 0) continue;
        
        html += `
            <h4 style="color: #4fc3f7; margin-top: 20px; margin-bottom: 12px;">${segmentLabels[key] || key}</h4>
            <table class="segment-table">
                <thead>
                    <tr>
                        <th>åŒºåˆ†</th>
                        <th>ãƒ¬ãƒ¼ã‚¹æ•°</th>
                        <th>çš„ä¸­</th>
                        <th>çš„ä¸­ç‡</th>
                        <th>å›åç‡</th>
                        <th>åæ”¯</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.entries(data).sort((a, b) => b[1].recovery_rate - a[1].recovery_rate).map(([name, stats]) => `
                        <tr>
                            <td><strong>${name}</strong></td>
                            <td>${stats.races}</td>
                            <td>${stats.hits}</td>
                            <td style="color: ${stats.hit_rate >= 15 ? '#4caf50' : '#fff'}">${stats.hit_rate}%</td>
                            <td style="color: ${stats.recovery_rate >= 100 ? '#4caf50' : stats.recovery_rate >= 80 ? '#fff' : '#f44336'}">${stats.recovery_rate}%</td>
                            <td style="color: ${stats.profit >= 0 ? '#4caf50' : '#f44336'}">Â¥${stats.profit.toLocaleString()}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }
    
    html += '</div>';
    return html;
}

// ãƒšãƒ¼ã‚¹åˆ†æè¡¨ç¤º
function renderPaceAnalysis(paceData) {
    let html = `
        <div class="report-section">
            <div class="report-section-title">âš¡ ãƒ¬ãƒ¼ã‚¹å±•é–‹åˆ†æ</div>
            <div class="pace-grid">
    `;
    
    for (const [pace, stats] of Object.entries(paceData)) {
        html += `
            <div class="pace-card">
                <div class="pace-name">${pace}</div>
                <div class="pace-stat">
                    <span class="pace-stat-label">ãƒ¬ãƒ¼ã‚¹æ•°</span>
                    <span class="pace-stat-value">${stats.races}</span>
                </div>
                <div class="pace-stat">
                    <span class="pace-stat-label">çš„ä¸­ç‡</span>
                    <span class="pace-stat-value" style="color: ${stats.hit_rate >= 15 ? '#4caf50' : '#fff'}">${stats.hit_rate}%</span>
                </div>
                <div class="pace-stat">
                    <span class="pace-stat-label">å›åç‡</span>
                    <span class="pace-stat-value" style="color: ${stats.recovery_rate >= 100 ? '#4caf50' : '#fff'}">${stats.recovery_rate}%</span>
                </div>
                <div class="pace-stat">
                    <span class="pace-stat-label">åæ”¯</span>
                    <span class="pace-stat-value" style="color: ${stats.profit >= 0 ? '#4caf50' : '#f44336'}">Â¥${stats.profit.toLocaleString()}</span>
                </div>
        `;
        
        // è»¸é¦¬è„šè³ªåˆ¥æˆç¸¾
        if (stats.axis_runstyle_performance && Object.keys(stats.axis_runstyle_performance).length > 0) {
            html += `
                <div class="runstyle-breakdown">
                    <div class="summary-label">â—è»¸é¦¬ã®è„šè³ªåˆ¥çš„ä¸­ç‡</div>
            `;
            for (const [runstyle, rsStats] of Object.entries(stats.axis_runstyle_performance)) {
                html += `
                    <div class="runstyle-item">
                        <span class="runstyle-name">${runstyle}</span>
                        <span class="runstyle-hitrate">${rsStats.hit_rate}% (${rsStats.hits}/${rsStats.races})</span>
                    </div>
                `;
            }
            html += '</div>';
        }
        
        html += '</div>';
    }
    
    html += '</div></div>';
    return html;
}

// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
function getReportTypeLabel(type) {
    const labels = {
        'daily': 'ğŸ“… æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
        'weekly': 'ğŸ“Š é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ',
        'monthly': 'ğŸ“ˆ æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ'
    };
    return labels[type] || 'ãƒ¬ãƒãƒ¼ãƒˆ';
}

function getReportPeriod(report) {
    if (report.target_date) {
        return report.target_date;
    } else if (report.period) {
        return report.period;
    } else if (report.year_month) {
        return report.year_month;
    }
    return '';
}

function formatReportDate(date, format) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    
    if (format === 'YYYYMMDD') {
        return `${year}${month}${day}`;
    } else if (format === 'YYYYMM') {
        return `${year}${month}`;
    }
    return `${year}-${month}-${day}`;
}

function getMonday(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
}

// åˆæœŸèª­ã¿è¾¼ã¿ï¼ˆãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ–ãŒé–‹ã‹ã‚ŒãŸã¨ãï¼‰
function initReports() {
    loadReport('daily');
}
    </script>
</body>
</html>
